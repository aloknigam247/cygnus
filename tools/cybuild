#!/bin/bash

source $CYGNUS_HOME/tools/funcs.bash    # source common functions

OPTION['--strict']="value=bool,eval=RUN_MODE=strict,help=use strict options for compilation"
OPTION['--lint']="value=bool,eval=RUN_MODE=lint,help=use lint tool along with compilation"

strictRun() {
    mkdir -p reports/warnings
    make -q `pwd`/build/bin/cygnus && make clean
    make STRICT=yes 2>reports/warnings/warns
    echo "Warnings: `grep -c "warning:" reports/warnings/warns`"
}

lintRun() {
    mkdir -p reports/lint
    make -q `pwd`/build/bin/cygnus && make clean
    scan-build-8 --status-bugs -stats -o report/lint make STRICT=yes
}

main() {
    parseCmdLine $@
    case $RUN_MODE in
        lint)
            lintRun
            ;;
        strict)
            strictRun
            ;;
        *)
            make
            ;;
    esac
}

main $@
