#!/bin/bash

source $CYGNUS_HOME/tools/funcs.bash    # source common functions

adder() {
    local sum=0
    while [[ $1 ]]; do
        sum=$((sum+$1))
        shift
    done
    echo $sum
}

covReport() {
    echo "Coverage Report::"
    test -f reports/coverage/func/html/index.html && echo "    Funtional Coverage: $(egrep -m 1 "headerCovTableEntryHi" reports/coverage/func/html/index.html | sed -r 's/[^0-9.]//g')%" || echo "    Functional Coverage: 0%"
    test -f reports/coverage/unit/html/index.html && echo "    Unit Coverage: $(egrep -m 1 "headerCovTableEntryHi" reports/coverage/unit/html/index.html | sed -r 's/[^0-9.]//g')%" || echo "    Unit Coverage: 0%"
    echo
}

memReport() {
    echo "Memory Report::"
    test -f reports/mem-check/func/errors && echo "    Functional: $(adder $(egrep -o "[0-9] errors" reports/mem-check/func/errors | sed 's/ errors//'))" || echo "    Functional: -1"
    test -f reports/mem-check/unit/errors && echo "    Unit: $(adder $(egrep -o "[0-9] errors" reports/mem-check/unit/errors | sed 's/ errors//'))" || echo "   Unit: -1"
    echo
}

docsReport() {
    echo "DOCS::"
    echo "Status:"
    test -f reports/docs/status && cat reports/docs/status
    echo ""
    echo "Undocumented:"
    test -f reports/docs/undoc && cat reports/docs/undoc
    echo ""
}

unitReport() {
    echo "Unit Test::"
    echo "Log:"
    test -f unittest.log && cat unittest.log
    echo ""
}

warnReport() {
    echo "Compiler Warnings::"
    test -f reports/warnings/warns
    echo ""
}

lintReport() {
    echo "Lint Report::"
    echo ""
}

perfReport() {
    echo "Performace Report::"
    echo ""
}

main() {
    parseCmdLine $@
    docsReport
    unitReport
    warnReport
    lintReport
    covReport
    memReport
    perfReport
    EXIT
}

main $@
